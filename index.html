<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amini - Personal Security App</title>
    <link rel="stylesheet" href="style.css">

    <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32.png">
    
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    
    <meta name="theme-color" content="#232938">
    
    <title>Amini App | Secure SOS Alerts</title>

    <style>
    /* 1. Force forms to the very top layer */
    #login-container, #register-container, #login-form, #register-form {
        position: relative !important;
        z-index: 9999 !important;
        display: block; /* Ensure they aren't collapsed */
    }

    /* 2. Make the inputs specifically 'punch through' any overlays */
    input[type="password"], input[type="email"], input[type="text"] {
        position: relative !important;
        z-index: 10000 !important;
        cursor: text !important;
        pointer-events: auto !important;
        background-color: #fff !important; /* Ensure visibility */
    }

    /* 3. The eye icon button */
    #passwordToggle {
        z-index: 10001 !important;
        cursor: pointer !important;
    }

    /* 4. Kill any invisible branding layer that might be hanging over the middle of the screen */
    .app-branding, header, .logo-section {
        pointer-events: none; /* Mouse clicks go THROUGH this layer */
    }
    
    /* Re-enable clicks for branding content specifically if needed */
    .app-branding h1, .app-branding img {
        pointer-events: auto;
    }
</style>
    </style>
    
  </head>

 <body>
    

  <div class="app-container">
    <div class="app-branding">
        <h1>Amini- Personal Security App</h1>
        <p>Your secure peace of mind.</p>
    </div>

    <section id="auth-screens">
        <div id="login-container">
            <form id="login-form">
                </form>
                <h2>Login to Amini</h2>
                <div>
                    <label for="login-email">Email</label><br>
                    <input type="email" id="login-email" required>
                </div>
                <div>
                    <label for="login-password">Password</label><br>
                    <input type="password" id="login-password" required>
                </div>
                <button type="submit">Login</button>
                <p id="login-message-area"></p>
                <p>Need an account? <a href="#" id="show-register-link">Sign Up</a></p>
            </form>
        </div>

        <div id="register-container" style="display: none;">
            <form id="register-form">
                </form>
                <h2>Register for Amini</h2>
                <p>Create your account to get started.</p>
                <div>
                    <label for="register-email">Email</label><br>
                    <input type="email" id="register-email" required>
                </div>
                
                <div class="input-container">
                    <label for="passwordInput">Password</label>
                    <div style="position: relative;">
                        <input type="password" id="passwordInput" placeholder="Create Password" required
                        style="width: 100%; padding-right: 40px;"><button type="button" id="passwordToggle" style="position: absolute; top: 50%; right: 5px; transform: translateY(-50%); border: none; background: transparent; cursor: pointer;">
                            <span id="toggleIcon">üëÅÔ∏è</span>
                        </button>
                    </div>
                </div>
                <button type="submit">Register</button>
                <p id="message-area"></p>
                <p>Already have an account? <a href="#" id="show-login-link">Log In</a></p>
            </form>
        </div>
        
    </section> 
    <section id="main-app" class="hidden">
        
        <h2 id="welcome-message">Welcome!</h2>
        <button id="logout-btn">Logout</button>
        
        <hr>
        
      <main>
        <div class="feature-card sos-card">
          <h3>Emergency Alert</h3>
          <button id="sos-btn">SOS</button>
          <p>Press and hold for 3 seconds</p>
        </div>
        
        <div class="feature-card">
          <h3>Your Location</h3>
          <p id="location-display">Location will appear here...</p>
          <button id="get-location-btn">Update Location</button>
        </div>
        
        <div class="feature-card">
          <h3>Emergency Contacts</h3>
          <ul id="contact-list">
            <li>Police (911)</li>
            <li>Ambulance (112)</li>
          </ul>
          <div class="input-group">
            <input type="text" id="contact-input" placeholder="Add contact (e.g., Mom)">
            <button id="add-contact-btn">Add</button>
          </div>
        </div>
        <h3>Secure Communication</h3>
        <div id="secure-message-section">
        <input type="text" id="secure-message-input" placeholder="Type a secure message...">"
        <button id="send-message-btn" class="sos-button">Send Secure Message</button>
        <p id="status-log"></p>
      </div>
        <h3>Activity Log</h3>
        <div id="activity-log">
            </div>

    </section>
    
          <div id="status-log"></div>
            <p>App initialized.</p>
          </div>
    
        </main>

  <script type="module">
    
// ==========================================
// 1. DEBUG & INITIALIZATION
// ==========================================
console.log("Amini Master Script Active");

const loginContainer = document.getElementById('login-container');
const registerContainer = document.getElementById('register-container');
const showRegisterLink = document.getElementById('show-register-link');
const showLoginLink = document.getElementById('show-login-link');

// ==========================================
// 2. PASSWORD TOGGLE LOGIC
// ==========================================
const passwordToggle = document.getElementById('passwordToggle');
const passwordInput = document.getElementById('passwordInput');
const toggleIcon = document.getElementById('toggleIcon');

if (passwordToggle && passwordInput) {
    passwordToggle.addEventListener('click', (e) => {
        e.preventDefault(); // Extra safety
        const isPassword = passwordInput.type === 'password';
        passwordInput.type = isPassword ? 'text' : 'password';
        if (toggleIcon) toggleIcon.textContent = isPassword ? 'üôà' : 'üëÅÔ∏è';
    });
}

// ==========================================
// 3. SCREEN SWITCHING (TOGGLE)
// ==========================================
if (showRegisterLink && loginContainer && registerContainer) {
    showRegisterLink.addEventListener('click', (e) => {
        e.preventDefault();
        loginContainer.style.display = 'none';
        registerContainer.style.display = 'block';
    });
}

if (showLoginLink && loginContainer && registerContainer) {
    showLoginLink.addEventListener('click', (e) => {
        e.preventDefault();
        registerContainer.style.display = 'none';
        loginContainer.style.display = 'block';
    });
}

// ==========================================
// 4. LOGIN LOGIC
// ==========================================
const loginForm = document.getElementById('login-form');
if (loginForm) {
    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;
        const messageArea = document.getElementById('login-message-area');

        try {
            const response = await fetch('/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });
            const data = await response.json();
            if (response.ok) {
                localStorage.setItem('token', data.token);
                messageArea.style.color = "green";
                messageArea.textContent = "Login successful! Redirecting...";
                setTimeout(() => window.location.href = '/dashboard.html', 1500);
            } else {
                messageArea.style.color = "red";
                messageArea.textContent = data.message || "Invalid credentials";
            }
        } catch (err) {
            messageArea.textContent = "Server error. Check connection.";
        }
    });
}

// ==========================================
// 5. REGISTER LOGIC
// ==========================================
const registerForm = document.getElementById('register-form');
if (registerForm) {
    registerForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('register-email').value;
        const password = document.getElementById('passwordInput').value;
        const messageArea = document.getElementById('message-area');

        try {
            const response = await fetch('/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });
            const data = await response.json();
            if (response.ok) {
                messageArea.style.color = "green";
                messageArea.textContent = "Account created! Switching to login...";
                setTimeout(() => showLoginLink.click(), 2000);
            } else {
                messageArea.style.color = "red";
                messageArea.textContent = data.message || "Registration failed";
            }
        } catch (err) {
            messageArea.textContent = "Database connection error.";
        }
    });
}
  </script>
</body>

</html>
